<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Horario | TP Enfermería</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="icon" href="logo-tp.webp">
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    :root{
      --bg:#f8fafc; --card:#fff; --text:#0f172a; --muted:#64748b;
      --primary:#3b82f6; --primary-700:#1d4ed8; --primary-50:#eff6ff;
      --success:#10b981; --warning:#f59e0b; --danger:#ef4444; --line:#e2e8f0;
      --shadow-sm:0 1px 2px 0 rgba(0,0,0,0.05);
      --shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:Inter,system-ui,sans-serif;color:var(--text);background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);min-height:100vh}
    .container{max-width:1200px;margin:20px auto;padding:0 20px}
    .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:24px;transition:all .3s ease}

    /* Header (alineado a index/alumnos) */
    .site-header{position:fixed;top:0;left:0;right:0;z-index:3000;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);box-shadow:var(--shadow-sm)}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 20px;border-bottom:1px solid var(--line)}
    .topbar-left{display:flex;gap:12px;align-items:center}
    .topbar-right{display:flex;gap:16px;align-items:center;position:relative}
    .icon{width:20px;height:20px;display:inline-block}
    .icon svg{width:100%;height:100%}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .link-icon{display:inline-flex;align-items:center;gap:8px;color:var(--muted);text-decoration:none;font-size:.9rem;padding:8px 12px;border-radius:8px}
    .link-icon:hover{color:var(--primary);background:var(--primary-50)}

    .navbar{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:12px 20px;background:rgba(255,255,255,.8)}
    .hamb{display:none;background:linear-gradient(135deg,var(--primary),var(--success));color:#fff;border:none;border-radius:10px;padding:10px 16px;font-weight:600}
    .menu{display:flex;gap:24px;align-items:center}
    .menu a{color:var(--primary-700);text-decoration:none;font-weight:600;padding:8px 16px;border-radius:8px}
    .menu a:hover{background:var(--primary-50);color:var(--primary)}
    .logo{display:flex;justify-content:center}
    .logo img{height:100px;width:100px;border-radius:50%;box-shadow:var(--shadow);border:4px solid #fff}
    .header-spacer{height:160px}

    .nav-item{position:relative}
    .nav-item>a,.nav-item>button{all:unset;cursor:pointer;color:var(--primary-700);font-weight:700;padding:6px 0}
    .nav-item.has-sub>button .chev{display:inline-block;transform:rotate(0deg);transition:transform .18s ease}
    .nav-item.has-sub.open>button .chev{transform:rotate(90deg)}
    .submenu{display:none;position:absolute;top:32px;left:0;background:#fff;border:1px solid var(--line);box-shadow:0 10px 30px rgba(2,6,23,.12);border-radius:12px;padding:8px;min-width:220px;z-index:5000}
    .submenu a{display:block;padding:8px 10px;border-radius:8px;color:#0f172a;text-decoration:none}
    .submenu a:hover{background:#f1f5f9}
    .nav-item.has-sub.open>.submenu{display:block}
    @media(hover:hover) and (pointer:fine){ .nav-item.has-sub:hover>.submenu{display:block} }
    #nav-user{position:relative;margin-left:8px}
    #nav-user .submenu{right:0;left:auto;top:32px}

    @media(max-width:800px){
      .navbar{grid-template-columns:auto 1fr auto}
      .hamb{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:10px;padding:8px;background:#fff;cursor:pointer}
      .menu{display:none;position:absolute;top:124px;left:0;right:0;background:#fff;border-top:1px solid var(--line);padding:12px;flex-direction:column;gap:12px;z-index:3050}
      .menu.open{display:flex}
      .logo{grid-column:2}
      .topbar{flex-wrap:wrap;gap:8px}
      .topbar-right{margin-left:auto}
      .submenu{position:static;border:1px solid var(--line);border-radius:10px;box-shadow:none;margin-top:6px}
      #nav-user .submenu{position:static;right:auto;left:auto;top:auto}
    }

    /* Hero */
    header.hero{background:linear-gradient(135deg,var(--primary) 0%,var(--success) 50%,var(--warning) 100%);color:#fff;padding:60px 20px;text-align:center;position:relative;overflow:hidden;margin-bottom:40px}
    header.hero h1{position:relative;z-index:1;font-size:3rem;font-weight:800;margin:0;text-shadow:0 2px 4px rgba(0,0,0,0.1)}
    header.hero p{position:relative;z-index:1;font-size:1.2rem;opacity:0.95;margin:12px 0 0 0}

    /* Tabla de horario */
    .table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .table th,.table td{padding:12px 14px;border-bottom:1px solid var(--line);text-align:left}
    .table thead th{background:#f8fafc;color:#0f172a;font-weight:800}
    .table tr:last-child td{border-bottom:0}
    .badge{display:inline-block;background:var(--primary-50);color:var(--primary-700);border:1px solid var(--line);padding:6px 12px;border-radius:999px;font-weight:800;font-size:.9rem}
    .b-teoria{background:#e0e7ff;color:#1e3a8a;border-color:#c7d2fe}
    .b-lab{background:#dcfce7;color:#065f46;border-color:#bbf7d0}
    .b-taller{background:#cffafe;color:#0e7490;border-color:#a5f3fc}
    .b-libre{background:#f1f5f9;color:#334155;border-color:#e2e8f0}

    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0 14px}
    .controls .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer;box-shadow:var(--shadow-sm);font-weight:700}
    .controls .btn.primary{background:#0b6bcb;color:#fff;border-color:#0b6bcb}
    .controls select{padding:8px 10px;border:1px solid var(--line);border-radius:10px}

    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .legend .item{display:flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff}
    .legend .dot{width:10px;height:10px;border-radius:50%}
    .export-title-main{font-size:1.8rem;font-weight:800;color:var(--primary-700);margin:0}
    .export-title-sub{font-size:1.1rem;font-weight:700;color:#0f172a;margin:4px 0 12px}

    /* Estilos de impresión */
    @media print{
      .site-header,.hamb,.menu,.controls,.legend,#scheduleWrap{display:none!important}
      #exportView{display:block!important}
      body{background:#fff}
      header.hero{background:#fff;color:#000;border-bottom:2px solid #e5e7eb}
      .card{box-shadow:none;border:0}
      .table{border:0;border-spacing:10px}
      .table th,.table td{border:0}
    }
  </style>
</head>
<body>
  <div class="site-wrap">
    <!-- Header integrado (como index) -->
    <div class="site-header">
      <div class="topbar">
        <div class="topbar-left">
          <button class="hamb" id="hamb" aria-label="Abrir menú">
            <span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg></span><span>Menú</span>
          </button>
        </div>
        <div class="topbar-right">
          <a class="link-icon" href="#" aria-label="Facebook"><span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 12a10 10 0 1 0-11.6 9.9v-7h-2v-3h2v-2.3c0-2 1.2-3.1 3-3.1.9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.7-1.3 1.2V12h2.3l-.4 3h-1.9v7A10 10 0 0 0 22 12z"/></svg></span><span class="sr-only">Facebook</span></a>
          <a class="link-icon" href="#" aria-label="LinkedIn"><span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM0 8h5v16H0zM8 8h4.8v2.2h.1c.7-1.2 2.3-2.5 4.8-2.5 5.1 0 6 3.3 6 7.6V24h-5v-7.5c0-1.8 0-4.1-2.5-4.1-2.5 0-2.9 2-2.9 4v7.6H8z"/></svg></span><span class="sr-only">LinkedIn</span></a>
          <a class="link-icon" href="#" aria-label="Instagram"><span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm6.5-.9a1.1 1.1 0 1 0 0 2.2 1.1 1.1 0 0 0 0-2.2zM12 9a3 3 0 1 1 0 6 3 3 0 0 1 0-6z"/></svg></span><span class="sr-only">Instagram</span></a>
          <a class="link-icon" href="#" aria-label="TikTok"><span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M21 7.2c-2 0-3.8-.7-5.2-2.1V16a6 6 0 1 1-6-6c.4 0 .7 0 1 .1v3.5a3 3 0 1 0 2 2.8V1h3.2c.4 1.9 2.2 3.4 4.1 3.6V7.2z"/></svg></span><span class="sr-only">TikTok</span></a>

          <!-- Cuenta -->
          <div id="nav-user" class="nav-item has-sub">
            <button><span id="nav-username">Cuenta</span> <span class="chev">›</span></button>
            <div class="submenu" id="accountMenu" style="min-width:200px"></div>
          </div>
          <div id="exportView" style="display:none;background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px"></div>
        </div>
      </div>

      <div class="navbar">
        <nav id="mainMenu" class="menu">
          <a href="index.html">Inicio</a>
          <div class="nav-item has-sub">
            <button data-menu-id="institucion">Institución <span class="chev">›</span></button>
            <div class="submenu">
              <a href="nosotros.html">Nosotros</a>
              <a href="programa.html">Programa</a>
              <a href="convenios.html">Convenios</a>
              <a href="contacto.html">Contacto</a>
            </div>
          </div>
          <a href="docentes.html">Docentes</a>
          <div class="nav-item has-sub">
            <button data-menu-id="Estudiantes">Estudiantes <span class="chev">›</span></button>
            <div class="submenu">
              <a href="alumnos.html">Alumnos</a>
              <a href="exalumnos.html">Exalumnos</a>
              <a href="horario.html">Horario</a>
            </div>
          </div>
          <a id="nav-admin" href="admin.html" style="display:none">Admin</a>
        </nav>
        <a class="logo" href="index.html"><img src="logo-tp.webp" alt="TP" /></a>
        <div></div>
      </div>
    </div>

    <div class="header-spacer"></div>

    <header class="hero">
      <h1>Horario de Clases</h1>
      <p>Consulta la distribución semanal de asignaturas y bloques</p>
    </header>

    <main class="site-main">
      <div class="container">
        <div class="card" id="scheduleCard">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px">
            <h2 style="margin:0;color:var(--primary-700)">Horario de Clases — TP Enfermería</h2>
          </div>
          <div class="controls">
            <div>
              <label class="muted" for="sel-curso" style="font-weight:700;margin-right:8px">Curso:</label>
              <select id="sel-curso">
                <option value="3A">3º A</option>
                <option value="3B">3º B</option>
              </select>
            </div>
            <button class="btn" id="btn-print">
              <span class="icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 8H5c-1.66 0-3 1.34-3 3v4h4v4h12v-4h4v-4c0-1.66-1.34-3-3-3zm-3 9H8v-5h8v5zM17 3H7v4h10V3z"/></svg></span>
              Imprimir
            </button>
            <button class="btn primary" id="btn-pdf">
              <span class="icon" style="color:#fff"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a5 5 0 0 1 5 5v1h1a4 4 0 1 1 0 8h-1v1a5 5 0 1 1-10 0v-1H6a4 4 0 1 1 0-8h1V7a5 5 0 0 1 5-5z"/></svg></span>
              Descargar PDF
            </button>
          </div>
          <div id="scheduleWrap" style="overflow:auto;background:#fff;padding:6px;border-radius:12px;border:1px solid var(--line)">
            <table class="table" id="tbl-horario"></table>
            <div class="legend">
              <div class="item"><span class="dot" style="background:#e0e7ff"></span> Teoría</div>
              <div class="item"><span class="dot" style="background:#dcfce7"></span> Laboratorio</div>
              <div class="item"><span class="dot" style="background:#cffafe"></span> Taller</div>
              <div class="item"><span class="dot" style="background:#f1f5f9"></span> Libre</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div data-include="footer"></div>
  </div>

  <!-- Scripts -->
  <script src="assets/include.js"></script>
  <script type="module" src="assets/live-sync-init.js"></script>
  <!-- libs para exportar PDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    // Menú hamburguesa + dropdowns robusto
    function setupHeader(){
      const hamb=document.getElementById('hamb');
      const navMenu=document.getElementById('mainMenu');
      if(hamb&&navMenu){
        hamb.addEventListener('click',(e)=>{e.stopPropagation();navMenu.classList.toggle('open');});
        document.addEventListener('click',()=>{navMenu.classList.remove('open');});
      }
      const dropdowns=document.querySelectorAll('.nav-item.has-sub');
      dropdowns.forEach(drop=>{
        const toggle=(e)=>{
          if(e.target && e.target.closest && e.target.closest('.submenu a')) return;
          e.preventDefault(); e.stopPropagation();
          const wasOpen=drop.classList.contains('open');
          dropdowns.forEach(d=>d.classList.remove('open'));
          if(!wasOpen) drop.classList.add('open');
        };
        drop.addEventListener('click',toggle);
        const btn=drop.querySelector('button, a');
        if(btn) btn.addEventListener('click',toggle);
        drop.addEventListener('mouseenter',()=>{ if(window.matchMedia('(hover:hover)').matches){ dropdowns.forEach(d=>d.classList.remove('open')); drop.classList.add('open'); } });
        drop.addEventListener('mouseleave',()=>{ if(window.matchMedia('(hover:hover)').matches){ drop.classList.remove('open'); } });
      });
      const submenuLinks=document.querySelectorAll('.nav-item.has-sub .submenu a');
      submenuLinks.forEach(a=>a.addEventListener('click',()=>{ dropdowns.forEach(d=>d.classList.remove('open')); }));
    }
    document.addEventListener('DOMContentLoaded',setupHeader);
  </script>
  <script type="module">
    import { initAuthUI } from './auth.js';
    window.addEventListener('DOMContentLoaded', () => setTimeout(initAuthUI, 0));
    setTimeout(initAuthUI, 250); setTimeout(initAuthUI, 800);
    document.addEventListener('readystatechange', () => { if (document.readyState === 'complete') initAuthUI(); });
    window.addEventListener('load', initAuthUI);
  </script>
  <script>
    // Datos de ejemplo: bloques y contenido por curso
    // Horario oficial: 08:30 a 16:30 (bloques de 1 hora)
    const BLOQUES = ['08:30','09:30','10:30','11:30','12:30','13:30','14:30','15:30'];
    const DIAS = ['Hora','Luns','Mar','Mié','Jue','Vie'];
    const DATA = {
      '3A': {
        '08:30': ['Teoría','Teoría','Labora','Taller',null],
        '09:30': ['Labora','Labora','Taller',null,null],
        '10:30': ['Taller','Taller','Libre',null,null],
        '11:30': ['Libre',null,null,null,null],
        '12:30': [null,null,null,null,null],
        '13:30': [null,null,null,null,null],
        '14:30': [null,null,null,null,null],
        '15:30': [null,null,null,null,null]
      },
      '3B': {
        '08:30': ['Labora','Teoría','Teoría','Taller',null],
        '09:30': ['Teoría','Labora','Taller',null,null],
        '10:30': ['Taller','Libre','Taller',null,null],
        '11:30': [null,null,null,null,null],
        '12:30': [null,null,null,null,null],
        '13:30': [null,null,null,null,null],
        '14:30': [null,null,null,null,null],
        '15:30': [null,null,null,null,null]
      }
    };
    // Exponer datos para exportación (usados por el parche de impresión/PDF)
    window.BLOQUES = BLOQUES; window.DIAS = ['Hora','Lunes','Martes','Miércoles','Jueves','Viernes']; window.DATA = DATA;

    function badge(label){
      if(!label) return '<span class="badge b-empty">&nbsp;&nbsp;&nbsp;</span>';
      let cls='b-teoria';
      const l=label.toLowerCase();
      if(l.startsWith('lab')) cls='b-lab';
      else if(l.startsWith('tal')) cls='b-taller';
      else if(l.startsWith('lib')) cls='b-libre';
      return `<span class="badge ${cls}">${label}</span>`;
    }

    function renderTabla(curso){
      const d = DATA[curso] || {};
      const tbl = document.getElementById('tbl-horario');
      if(!tbl) return;
      let html = '<thead><tr>' + DIAS.map((h,i)=> i===0?`<th class="time-head">${h}</th>`:`<th class="day-head">${h}</th>`).join('') + '</tr></thead><tbody>';
      BLOQUES.forEach(b=>{
        const filas = d[b] || [null,null,null,null,null];
        html += `<tr><td class="time-cell">${b}</td>` + filas.map(x=>`<td class="day-cell">${badge(x)}</td>`).join('') + '</tr>';
      });
      html += '</tbody>';
      tbl.innerHTML = html;
    }

    function setupHorario(){
      const sel = document.getElementById('sel-curso');
      const btnPrint = document.getElementById('btn-print');
      const btnPdf = document.getElementById('btn-pdf');
      const card = document.getElementById('scheduleCard');
      const wrap = document.getElementById('scheduleWrap');
      if(sel){ sel.addEventListener('change', ()=> renderTabla(sel.value)); renderTabla(sel.value); }
      if(btnPrint) btnPrint.addEventListener('click', ()=> window.print());
      if(btnPdf) btnPdf.addEventListener('click', async ()=>{
        try{
          const { jsPDF } = window.jspdf || {};
          if(!jsPDF){ window.print(); return; }
          const canvas = await html2canvas(wrap, { scale: 2, backgroundColor:'#ffffff' });
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jsPDF('landscape','mm','a4');
          const pageWidth = pdf.internal.pageSize.getWidth();
          const pageHeight = pdf.internal.pageSize.getHeight();
          const imgWidth = pageWidth - 20; // márgenes
          const imgHeight = canvas.height * imgWidth / canvas.width;
          const y = (pageHeight - imgHeight)/2;
          pdf.addImage(imgData,'PNG',10,Math.max(10,y),imgWidth,imgHeight);
          const nombre = (sel && sel.value) ? sel.value : 'horario';
          pdf.save(`horario-${nombre}.pdf`);
        }catch(e){ console.warn('PDF export failed', e); window.print(); }
      });
    }
    document.addEventListener('DOMContentLoaded', setupHorario);
  </script>
  <script>
    // Parche de exportación: reemplaza listeners para usar la vista exportada A4
    document.addEventListener('DOMContentLoaded', function(){
      function renderExport(curso){
        const year = new Date().getFullYear();
        const d = (window.DATA && window.DATA[curso]) || {};
        const DIAS = window.DIAS || ['Hora','Lunes','Martes','Miércoles','Jueves','Viernes'];
        const BLOQUES = window.BLOQUES || [];
        function badge(label){
          if(!label) return '<span class="badge b-empty">&nbsp;&nbsp;&nbsp;</span>';
          let cls='b-teoria';
          const l=(label||'').toLowerCase();
          if(l.startsWith('lab')) cls='b-lab'; else if(l.startsWith('tal')) cls='b-taller'; else if(l.startsWith('lib')) cls='b-libre';
          return `<span class="badge ${cls}">${label}</span>`;
        }
        let table = '<table class="table" style="border-collapse:separate;border-spacing:12px;width:100%">';
        table += '<thead><tr>' + DIAS.map((h,i)=> i===0?`<th class="time-head">${h}</th>`:`<th class="day-head">${h}</th>`).join('') + '</tr></thead><tbody>';
        BLOQUES.forEach(b=>{
          const filas = d[b] || [null,null,null,null,null];
          table += `<tr><td class="time-cell">${b}</td>` + filas.map(x=>`<td class="day-cell">${badge(x)}</td>`).join('') + '</tr>';
        });
        table += '</tbody></table>';
        const legend = `
          <div class="legend" style="margin-top:12px">
            <div class="item"><span class="dot" style="background:#e0e7ff"></span> Teoría</div>
            <div class="item"><span class="dot" style="background:#dcfce7"></span> Laboratorio</div>
            <div class="item"><span class="dot" style="background:#cffafe"></span> Taller</div>
            <div class="item"><span class="dot" style="background:#f1f5f9"></span> Libre</div>
          </div>`;
        const notes = (document.getElementById('notesText')||{}).textContent || '';
        const noteBox = `<div style="margin-top:12px;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#f8fafc"><strong class="muted" style="margin-right:8px">Notas:</strong><span class="muted">${notes||''}</span></div>`;
        const title = `<h2 style="margin:0 0 12px 0;color:#0f172a">Horario ${curso.replace(/([A-Z])/g,' $1').trim()} — ${year}</h2>`;
        const exp = document.getElementById('exportView');
        if(exp){ exp.innerHTML = title + table + legend + noteBox; }
      }

      const btnPrint = document.getElementById('btn-print');
      const btnPdf = document.getElementById('btn-pdf');
      const sel = document.getElementById('sel-curso');
      const exp = document.getElementById('exportView');
      if(btnPrint){ const n = btnPrint.cloneNode(true); btnPrint.parentNode.replaceChild(n, btnPrint); n.addEventListener('click', ()=>{ const c = sel? sel.value : '3A'; renderExport(c); try{ const year=new Date().getFullYear(); const nice=(c||'').replace(/^(\d)/,'$1º ').replace(/([A-Z])$/,' $1'); const hdr=document.createElement('div'); hdr.innerHTML=`<div class=\"export-title-main\">Horario de Clases — TP Enfermería</div><div class=\"export-title-sub\">${nice} — ${year}</div>`; if(exp){ exp.insertBefore(hdr, exp.firstChild); exp.style.display='block'; } }catch(e){} setTimeout(()=>window.print(),50); setTimeout(()=>{ if(exp) exp.style.display='none'; },500); }); }
      if(btnPdf){ const n2 = btnPdf.cloneNode(true); btnPdf.parentNode.replaceChild(n2, btnPdf); n2.addEventListener('click', async ()=>{ const c = sel? sel.value : '3A'; renderExport(c); try{ const year=new Date().getFullYear(); const nice=(c||'').replace(/^(\d)/,'$1º ').replace(/([A-Z])$/,' $1'); const hdr=document.createElement('div'); hdr.innerHTML=`<div class=\"export-title-main\">Horario de Clases — TP Enfermería</div><div class=\"export-title-sub\">${nice} — ${year}</div>`; if(exp){ exp.insertBefore(hdr, exp.firstChild); exp.style.display='block'; } }catch(e){} try{ const canvas = await html2canvas(exp,{scale:2,backgroundColor:'#ffffff'}); const { jsPDF } = window.jspdf || {}; const pdf = new jsPDF('landscape','mm','a4'); const pageWidth=pdf.internal.pageSize.getWidth(); const pageHeight=pdf.internal.pageSize.getHeight(); const imgWidth=pageWidth-20; const imgHeight=canvas.height*imgWidth/canvas.width; const y=(pageHeight-imgHeight)/2; pdf.addImage(canvas.toDataURL('image/png'),'PNG',10,Math.max(10,y),imgWidth,imgHeight); pdf.save(`horario-${c}.pdf`);}catch(e){ console.warn(e); window.print(); } finally{ if(exp){ exp.style.display='none'; } } }); }
    });
  </script>
</body>
</html>

